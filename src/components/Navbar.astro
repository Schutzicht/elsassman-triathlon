---
import { Menu, X } from 'lucide-astro';

const links = [
    { name: "Home", href: "/" },
    { 
        name: "Races", 
        href: "#", 
        dropdown: [
            { name: "Distance L", href: "/races/distance-l" },
            { name: "Distance M", href: "/races/distance-m" },
            { name: "Distance S", href: "/races/distance-s" },
            { name: "Avenir 1 (6-9yo)", href: "/races/avenir-1" },
            { name: "Avenir 2 (10-13yo)", href: "/races/avenir-2" }
        ]
    },
    { 
        name: "Info", 
        href: "#", 
        dropdown: [
            { name: "Program", href: "/info/schedule" },
            { name: "Athlete Guide", href: "/info/athlete-guide" },
            { name: "Rules", href: "/info/rules" },
            { name: "Volunteers", href: "/benevoles" },
            { name: "Results", href: "/info/results" }
        ]
    },
    { name: "Contact", href: "/contact" },
];
---

<div class="fixed top-0 md:top-6 left-0 w-full z-50 flex justify-center transition-all duration-500" id="navbar-container">
    <header 
        id="main-header" 
        class="w-full max-w-7xl bg-brand-dark/20 backdrop-blur-3xl border border-white/5 px-6 lg:px-12 py-3 transition-all duration-500 relative"
    >
        <div class="flex items-center justify-between">
            <a href="/" class="flex items-center space-x-3 z-50 group">
                <img 
                    src="https://static.wixstatic.com/media/92dadc_7f1facba800c400bbf54d63deb452842~mv2.png/v1/crop/x_221,y_893,w_4560,h_1320/fill/w_176,h_53,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/elsassman%20V3_Plan%20de%20travail%2010.png" 
                    alt="Logo" 
                    class="h-10 w-auto transition-all duration-500 group-hover:scale-110"
                    id="header-logo"
                />
            </a>
            
            <div class="flex md:order-2">
                <button 
                    id="menu-toggle"
                    type="button" 
                    class="inline-flex items-center p-2 text-white md:hidden hover:text-brand-primary" 
                >
                    <Menu class="w-6 h-6 transition-all" id="menu-icon-open" />
                    <X class="w-6 h-6 hidden transition-all" id="menu-icon-close" />
                </button>
                <div class="hidden md:block">
                    <a href="/inscriptions" class="btn-primary py-2 px-6 text-xs transition-all">
                        Register
                    </a>
                </div>
            </div>

            <nav class="hidden md:flex w-full md:w-auto md:order-1" id="navbar-sticky">
                <ul class="flex flex-col p-4 md:p-0 font-tech md:space-x-10 md:flex-row">
                    {links.map((link) => (
                        <li class="relative group">
                            {link.dropdown ? (
                                <>
                                    <button class="flex items-center justify-between w-full py-2 px-3 text-white/60 group-hover:text-brand-primary transition-colors duration-300 uppercase tracking-[0.2em] text-[10px] font-black">
                                        {link.name}
                                        <svg class="w-2 h-2 ms-2 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 10 6">
                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
                                        </svg>
                                    </button>
                                    <div class="z-50 hidden md:group-hover:block absolute top-full left-1/2 -translate-x-1/2 pt-4 min-w-[200px]">
                                        <div class="bg-brand-dark/95 backdrop-blur-3xl border border-white/5 py-4 px-2">
                                            <ul class="space-y-1">
                                                {link.dropdown.map((subLink) => (
                                                    <li>
                                                        <a href={subLink.href} class="block px-4 py-2 hover:bg-brand-primary hover:text-black transition-all text-[10px] font-bold uppercase tracking-widest text-center">
                                                            {subLink.name}
                                                        </a>
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>
                                    </div>
                                </>
                            ) : (
                                <a 
                                    href={link.href} 
                                    class="block py-2 px-3 text-white/60 hover:text-brand-primary transition-colors duration-300 uppercase tracking-[0.2em] text-[10px] font-black"
                                >
                                    {link.name}
                                </a>
                            )}
                        </li>
                    ))}
                </ul>
            </nav>
        </div>
    </header>
</div>

<script>
    const header = document.getElementById('main-header');
    const container = document.getElementById('navbar-container');
    const menuToggle = document.getElementById('menu-toggle');
    const navbarSticky = document.getElementById('navbar-sticky');
    const menuIconOpen = document.getElementById('menu-icon-open');
    const menuIconClose = document.getElementById('menu-icon-close');

    const updateNavbar = () => {
        if (window.scrollY > 50) {
            header?.classList.add('bg-brand-dark/80');
            header?.classList.remove('bg-brand-dark/20');
            container?.classList.remove('md:top-6');
            container?.classList.add('top-0');
        } else {
            header?.classList.remove('bg-brand-dark/80');
            header?.classList.add('bg-brand-dark/20');
            if (window.innerWidth >= 768) {
                container?.classList.add('md:top-6');
            }
            container?.classList.remove('top-0');
        }
    };

    window.addEventListener('scroll', updateNavbar);
    window.addEventListener('resize', updateNavbar);
    updateNavbar();

    menuToggle?.addEventListener('click', () => {
        const isHidden = navbarSticky?.classList.contains('hidden');
        if (isHidden) {
            navbarSticky?.classList.remove('hidden');
            navbarSticky?.classList.add('flex', 'flex-col', 'absolute', 'top-full', 'left-0', 'w-full', 'bg-brand-dark/95', 'backdrop-blur-3xl', 'border-t', 'border-white/5', 'p-6');
            menuIconOpen?.classList.add('hidden');
            menuIconClose?.classList.remove('hidden');
            document.body.classList.add('overflow-hidden');
        } else {
            navbarSticky?.classList.add('hidden');
            navbarSticky?.classList.remove('flex', 'flex-col', 'absolute', 'top-full', 'left-0', 'w-full', 'bg-brand-dark/95', 'backdrop-blur-3xl', 'border-t', 'border-white/5', 'p-6');
            menuIconOpen?.classList.remove('hidden');
            menuIconClose?.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
        }
    });

    // Close menu on link click
    navbarSticky?.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
            navbarSticky?.classList.add('hidden');
            navbarSticky?.classList.remove('flex', 'flex-col', 'absolute', 'top-full', 'left-0', 'w-full', 'bg-brand-dark/95', 'backdrop-blur-3xl', 'border-t', 'border-white/5', 'p-6');
            menuIconOpen?.classList.remove('hidden');
            menuIconClose?.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
        });
    });
</script>
