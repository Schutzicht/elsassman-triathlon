---
const { lang = Astro.currentLocale || 'en' } = Astro.props;

const translations = {
    en: {
        feedTitle: "Real-time Feed",
        followTitle: "FOLLOW THE",
        followTitleSpan: "CHALLENGE",
        likes: "LIKES",
        views: "VIEWS",
        live: "LIVE FEED"
    },
    fr: {
        feedTitle: "Flux en Temps Réel",
        followTitle: "SUIVEZ LE",
        followTitleSpan: "DÉFI",
        likes: "J'AIME",
        views: "VUES",
        live: "EN DIRECT"
    }
};

const t = translations[lang === 'fr' ? 'fr' : 'en'];

const reels = [
    {
        id: 1,
        likes: "1.2k",
        views: "4.5k",
        image: "/assets/photography/social-1.jpg",
        link: "https://www.instagram.com/elsassman/"
    },
    {
        id: 2,
        likes: "856",
        views: "2.1k",
        image: "/assets/photography/social-2.jpg",
        link: "https://www.instagram.com/elsassman/"
    },
    {
        id: 3,
        likes: "2.5k",
        views: "10k",
        image: "/assets/photography/social-3.jpg",
        link: "https://www.instagram.com/elsassman/"
    },
    {
        id: 4,
        likes: "940",
        views: "3.2k",
        image: "/assets/photography/social-4.jpg",
        link: "https://www.instagram.com/elsassman/"
    },
    {
        id: 5,
        likes: "3.1k",
        views: "15k",
        image: "/assets/photography/social-5.jpg",
        link: "https://www.instagram.com/elsassman/"
    }
];
---

<section class="py-32 bg-black overflow-hidden border-t border-white/5">
    <div class="container mx-auto px-6 mb-16 flex flex-col md:flex-row justify-between items-start md:items-end gap-8">
        <div>
            <div class="flex items-center gap-3 mb-4">
                <div class="w-1 h-8 bg-brand-primary"></div>
                <span class="font-tech text-xs font-black uppercase tracking-[0.4em] text-white/40">{t.feedTitle}</span>
            </div>
            <h2 class="text-6xl font-display font-black text-white italic">
                {t.followTitle} <span class="text-brand-secondary">{t.followTitleSpan}</span>
            </h2>
        </div>
        <a href="https://www.instagram.com/elsassman/" target="_blank" class="font-tech text-xs font-black uppercase tracking-widest text-brand-primary border border-brand-primary/20 hover:bg-brand-primary hover:text-black px-8 py-3 transition-all">
            @ELSASSMAN
        </a>
    </div>

    <!-- Scrolling Container Wrapper -->
    <div class="relative overflow-hidden w-full group/carousel">
        <div id="social-carousel" class="flex overflow-x-auto pb-12 gap-8 px-6 snap-x snap-mandatory scrollbar-hide">
            {reels.map((reel) => (
                <a href={reel.link} target="_blank" class="snap-center shrink-0 w-72 h-[450px] relative overflow-hidden group border border-white/5 hover:border-brand-primary/40 transition-all duration-500">
                    <!-- Image -->
                    <img src={reel.image} alt="IG" class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110" />
                    
                    <!-- Overlay -->
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-80"></div>

                    <!-- Stats -->
                    <div class="absolute bottom-0 left-0 w-full p-6 flex justify-between items-end text-white font-tech text-[10px] font-black uppercase tracking-widest">
                        <div class="flex items-center gap-2">
                            <span class="text-brand-primary">{reel.likes}</span> {t.likes}
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-brand-secondary">{reel.views}</span> {t.views}
                        </div>
                    </div>

                    <!-- Adrenaline Badge -->
                    <div class="absolute top-6 right-6 opacity-0 group-hover:opacity-100 transition-opacity">
                        <div class="bg-brand-primary text-black px-2 py-1 font-tech text-[8px] font-black uppercase tracking-tighter italic">{t.live}</div>
                    </div>
                </a>
            ))}
        </div>

        <!-- Visual "Swipe" Indicator (Hidden on Desktop) -->
        <div class="absolute top-1/2 right-4 -translate-y-1/2 md:hidden pointer-events-none opacity-0 group-[.nudge-animate]/carousel:animate-fade-in-out">
            <div class="bg-brand-primary/20 backdrop-blur-md rounded-full p-3 border border-brand-primary/30">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-brand-primary animate-swipe-hand" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                </svg>
            </div>
        </div>
    </div>
</section>

<script>
    const initNudge = () => {
        const carousel = document.getElementById('social-carousel');
        const container = carousel?.parentElement;
        
        if (carousel && container && window.innerWidth < 768) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Delay the nudge so the user sees the section settle first
                        setTimeout(() => {
                            container.classList.add('nudge-animate');
                        }, 600);
                        
                        observer.unobserve(carousel);
                    }
                });
            }, { threshold: 0.3 });

            observer.observe(carousel);
        }
    };

    // Run on both initial load and view transitions
    initNudge();
    document.addEventListener('astro:page-load', initNudge);
</script>

<style>
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

    @keyframes nudge-swipe {
        0%, 100% { transform: translateX(0); }
        35% { transform: translateX(-120px); }
        65% { transform: translateX(10px); }
    }

    @keyframes swipe-hand {
        0%, 100% { transform: translateX(50px); opacity: 0; }
        30% { transform: translateX(0); opacity: 1; }
        60% { transform: translateX(-20px); opacity: 1; }
        90% { transform: translateX(-50px); opacity: 0; }
    }

    @keyframes fade-in-out {
        0%, 100% { opacity: 0; }
        20%, 80% { opacity: 1; }
    }

    .nudge-animate #social-carousel {
        animation: nudge-swipe 1.6s cubic-bezier(0.45, 0.05, 0.55, 0.95) forwards;
    }

    .animate-swipe-hand {
        animation: swipe-hand 1.6s ease-in-out forwards;
    }

    .animate-fade-in-out {
        animation: fade-in-out 1.6s ease-in-out forwards;
    }
</style>
